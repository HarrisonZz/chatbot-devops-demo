apiVersion: opentelemetry.io/v1alpha1
kind: Instrumentation
metadata:
  name: adot-instrumentation
spec:
  env:
    - name: OTEL_PYTHON_LOG_LEVEL
      value: "debug"
    - name: OTEL_LOG_LEVEL
      value: "debug"
  exporter:
    # å‘Šè¨´ App æŠŠè³‡æ–™ä¸Ÿçµ¦å‰›æ‰å»ºå¥½çš„ Collector
    endpoint: http://adot-collector-collector.observability.svc.cluster.local:4318
  propagators:
    - tracecontext
    - baggage
    - b3
  python: # å¦‚æœä½ çš„ App æ˜¯ Python
    image: public.ecr.aws/aws-observability/adot-autoinstrumentation-python:v0.12.1
    env:
      # ğŸ’¡ æ ¸å¿ƒè¨­å®šï¼šæ’é™¤æ‰åŒ…å« health é—œéµå­—çš„ URL è·¯å¾‘
      - name: OTEL_PYTHON_EXCLUDED_URLS
        value: "_stcore/health,healthz,client/.*/health"
      # ğŸ’¡ å»ºè­°åŒæ­¥èª¿æ•´ï¼šå°‡æ¡æ¨£ç‡è¨­ç‚º 100% (é™¤éŒ¯ç”¨) æˆ– 10% (çœéŒ¢ç”¨)
      - name: OTEL_TRACES_SAMPLER
        value: "always_on"
      - name: OTEL_PYTHON_LOG_CORRELATION
        value: "true"
      - name: OTEL_PYTHON_LOGGING_AUTO_INSTRUMENTATION
        value: "true"
      - name: OTEL_LOGS_EXPORTER
        value: "otlp"
      - name: OTEL_PYTHON_LOG_LEVEL
        value: "info"
      - name: OTEL_LOG_LEVEL
        value: "info"